# TDD 규칙 명세 (Test-Driven Development)

이 문서는 TDD(테스트 주도 개발) 원칙과 작업 흐름, 테스트 작성 규칙 및 PR 체크리스트를 정리한 것입니다.
팀과 과제에서 일관된 테스트를 작성하고 유지하기 위한 기준으로 활용하세요.

## 1. 기본 원칙
- TDD 사이클: Red → Green → Refactor
   - Red: 실패하는 최소한의 테스트를 작성한다.
   - Green: 테스트를 통과하도록 최소한의 코드(프로덕션 코드)를 작성한다.
   - Refactor: 중복 제거, 코드 정리, 리팩터링 후 모든 테스트를 통과시키는 상태를 유지한다.
- 테스트는 문서다: 테스트는 요구사항의 실행 가능한 사양으로 간주한다.
- 작은 단계로 자주 커밋한다: 각 Red→Green→Refactor 사이클은 별도의 커밋으로 남기는 것을 권장한다.

## 2. 언제 테스트를 작성하나
- 새로운 기능을 추가할 때: 먼저 실패하는 테스트를 작성.
- 버그 수정: 재현 테스트(회귀 테스트)를 먼저 작성하여 문제를 정의.
- 리팩터링: 기존 동작을 보존하는 테스트가 있어야 안전하게 리팩터링 가능.

## 3. 테스트 종류와 목적
- 단위 테스트(Unit): 순수 로직, 유틸, 훅 등 외부 의존성이 적은 단위에 대해 빠르게 검증.
- 통합 테스트(Integration): 여러 모듈/유틸/훅이 함께 동작하는 시나리오 검증.
- E2E/UI 테스트: 사용자 흐름과 상호작용(버튼 클릭, 폼 제출, 라우팅 등)을 검증.

프로젝트 내에서의 위치 권장:
- `src/__tests__/unit/` : 유틸 및 로직 테스트
- `src/__tests__/hooks/` : 커스텀 훅 테스트
- `src/__tests__/` (integration/medium): 컴포넌트/상호작용 테스트

## 4. 테스트 작성 규칙
- 네이밍
   - 파일: `*.spec.ts` 또는 `*.spec.tsx` (현재 스타일과 일치)
   - 테스트 설명은 한국어 문장으로 목적/행위를 명확히 기술: `it('...')` 또는 `test('...')`
- 구조: Arrange - Act - Assert
   - Arrange: 테스트 대상과 목업/초기 상태 준비
   - Act: 기능을 실행(호출/렌더/유저 액션)
   - Assert: 기대 결과 검증
- 단일 검증 항목을 하나의 `it` 블록에 담는다. 여러 검증이 필요하면 context를 분리.
- 외부 의존성은 목(mock)이나 MSW를 사용하여 격리한다. (이미 프로젝트는 `msw` 사용)

## 5. 유닛 테스트 작성 가이드 (예)
- 유틸 함수: 다양한 경계/엣지 케이스 포함
   - 빈 입력, null/undefined, 경계값(월말, 윤년 등)
- 훅: `renderHook` 또는 테스트 컴포넌트를 사용하여 상태/이펙트 검증

## 6. 반복 일정(이번 과제 관련) 테스트 규칙
- 반복 유형: `daily`, `weekly`, `monthly`, `yearly`, `none`를 모두 포함하는 케이스 작성
- 월 반복의 31일 규칙: 31일 기준 이벤트는 31일이 없는 달에는 생성하지 않는다(매월 마지막일로 내리는 것이 아님).
- 연간 반복의 윤년 규칙: 2월 29일은 윤년인 해에만 생성한다.
- 반복 종료: `repeat.endDate`를 지원하고, 명세 상 최대 종료일(`2025-12-31`)을 적용한 케이스 포함
- 수정/삭제 동작
   - 단일 수정/전체 수정: UI(또는 훅)에서 '해당 일정만' vs '모든 일정' 옵션을 선택했을 때의 동작을 검증
   - 단일 삭제/전체 삭제 케이스 작성

## 7. 테스트 도구/환경 규칙
- 테스트 러너: `vitest` (현재 프로젝트 설정)
- Testing Library: `@testing-library/react` + `user-event`로 사용자 동작 시뮬레이션
- Mock 서버: `msw`를 사용하여 API 응답을 제어
- 시간 관련 테스트: `vi.setSystemTime` / `vi.useFakeTimers`를 이용해 시간 종속성을 고정

## 8. 코드 스타일/커밋 규칙
- 작은 커밋: Red, Green, Refactor 각 단계마다 별도 커밋 권장
- 커밋 메시지: `[tdd] red: add failing test for ...` / `[tdd] green: implement ...` / `[tdd] refactor: ...` 처럼 단계 표기

## 9. PR 체크리스트 (TDD 관점)
- [ ] 관련 실패하는 테스트(레드)가 먼저 추가되었는가?
- [ ] 테스트가 통과하는 코드(그린)가 추가되었는가?
- [ ] 리팩터링이 있었고, 모든 테스트가 통과하는가?
- [ ] 유닛/통합/필요한 UI 테스트가 포함되었는가?
- [ ] 외부 의존성은 적절히 목/모킹 되었는가? (MSW 사용 권장)
- [ ] 중요한 엣지 케이스(빈값, 경계값, 윤년/월말 등)를 다루는 테스트가 있는가?
- [ ] 테스트가 불필요하게 긴 수행 시간을 요구하지 않는가? (빠른 단위 테스트 우선)

## 10. 테스트 커버리지 목표
- 기능에 따라 다르지만,
   - 핵심 로직/유틸: 100% 목표
   - 훅/비즈니스 로직: 80% 이상 권장
   - UI/통합: 시나리오 중심 커버리지

## 11. 리팩터링/기술부채 처리
- 리팩터링 전 반드시 관련 테스트가 있어야 한다.
- 테스트가 부족할 경우 리팩터링 전에 테스트를 먼저 추가하라.

## 12. 예제 테스트 템플릿
```ts
// Arrange
const input = ...;

// Act
const result = myFn(input);

// Assert
expect(result).toEqual(...);
```

## 마무리 노트
이 규칙은 팀의 합의와 프로젝트 특성에 따라 유연하게 적용하세요. 
테스트는 코드 품질을 보증하는 중요한 산출물입니다. PR에 어떤 테스트를 왜 추가했는지 간단히 설명해 주시면 리뷰가 훨씬 빨라집니다.

---
작성일: 2025-10-29

